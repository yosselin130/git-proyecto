{% include "./partials/header.html" %} {% block body %}

<body>
   <div class="container-fluid ">
      <nav class=" custom-nav navbar navbar-expand-lg navbar-light bg-light bg-ucsm text-center">
         <h3 class="d-block d-md-none display-4 boldletter"> SGRSIA</h1>
            <h3 class="d-md-block d-none display-6 boldletter"> SISTEMA DE GESTIÓN DE AUDITORÍA</h1>
               <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                  aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" style="background-color: white;"><span
                     class="navbar-toggler-icon"></span>
               </button>
               <div class="collapse navbar-collapse" id="navbarSupportedContent"  style="padding-left: 430px;">
                  <ul class="navbar-nav mr-auto">
                     <li class="nav-item active"><a class="nav-link" style="color: #fff;"
                           href="http://127.0.0.1:5000/home">Página Principal<span class="sr-only">(current)</span></a>
                     </li>
                     <li class="nav-item"><a class="nav-link" style="color: #fff;"
                           href="http://127.0.0.1:5000/logout">Cerrar Sesión</a></li>
                     <li class="nav-item"><a class="nav-link" style="color: #fff;" href="http://127.0.0.1:5000/">Iniciar
                           Sesión</a></li>
                     <li class="nav-item"><a class="nav-link" style="color: #fff;"
                           href="http://127.0.0.1:5000/registro">Registrarse</a></li>
                  </ul>
               </div>
      </nav>
      <div class="container-fluid">
         <div class="container" style="height: 450px!important">
            <form action="/proyecto" method="post" class="h-100 w-100">
               <div class="row h-100">
                  <div class="card" style="WIDTH: 100%;">
                     <h5 class="card-header bg-sc-ucsm text-center">Crear/Editar Proyecto</h5>
                     <div class="alert alert-info mb-2 py-1" role="alert">
                        <b>MANTENIMIENTO DE PROYECTOS</b>
                        <div class="float-right" value="{{ nombre }}">{{ nombre }}</div>
                     </div>
                     <div class="card-body ">
                        <div class="row h-100">
                           <div class="card-body card-body-custom ">
                              <!--<label for="Inputcod">Codigo Proyecto</label>
                                    <input class=" form-control"  readonly type="text"  value="{{ project }}" placeholder="Codigo" name="paData[CIDPROY]">
                              <br>
                              <label for="Inputdesc">Descripcion</label>
                              <input class="form-control" type="text" placeholder="Descripcion" name="paData[CDESCRI]" value="{{ descri }}">
                              <br>
                              <label for="Inputres">DNI</label>
                              <input class="form-control" value="{{ cnrodni }}" type="text" placeholder="Responsable" name="paData[CDNIRES]">
                              <br>
                              <label for="Inputres">Responsable</label>
                              <input class="form-control" value="{{ resp }}" type="text" placeholder="Responsable"
                                 name="paData[CRESPONSABLE]">
                              <br>
                              <label for="Inputest">Estado</label>
                              <br>
                              <select class="custom-select custom-select-sm col-4" name="paData[CESTADO]"
                                 id="paData[CESTADO]">
                                 {% set states = {'ACTIVO': 'A', 'FINALIZADO': 'F', 'ANULADO': 'X'} %}
                                 {% for data in paDatos %}
                                 {{ estado }}
                                 {% if data[0] == estado %}
                                    <option selected="selected" value="{{ states[data[0]] }}">{{ data[0] }}</option>
                                 {% else %}
                                    <option value="{{ states[data[0]] }}">{{ data[0] }}</option>
                                 {% endif %}
                                 
                                 {% endfor %}
                              </select>-->
                              <div class="row col-xs-12">
                                 <span class="input-group-text input-group-addon text-left alert-info">Codigo Proyecto</span>
                                 <input class=" form-control"  readonly type="text"  value="{{ project }}" placeholder="Codigo" name="paData[CIDPROY]" aria-describedby="basic-addon1" style="width: 20%;"><br>
                                 <span class="input-group-text text-left alert-info" style="margin-left: 3%;">Descripcion</span>
                                 <input class="form-control" type="text" placeholder="Descripcion" name="paData[CDESCRI]" value="{{ descri }}" aria-describedby="basic-addon1" style="width: 40%;">
                                    <!--<input name="remitosucursal" id="remitosucursal" type="text" required  placeholder="Sucursal" class="col-xs-6">
                                    <input name="remitonumero" id="remitonumero" type="text" required placeholder="Numero"  class="col-xs-6">-->
                              </div><br><br>
                              <div class="row col-xs-12">
                                 <span class="input-group-text input-group-addon text-left alert-info">Responsable Actual</span>
                                 <input class="form-control" value="{{ cnrodni }}"  placeholder="Responsable" name="paData[CDNIRES]" type="hidden">
                                 <input class="form-control" value="{{ resp }}" readonly type="text" placeholder="Responsable" name="paData[CRESPONSABLE]" aria-describedby="basic-addon1" style="width: 44%;">
                                 <span class="input-group-text input-group-addon text-left alert-info">Responsable Nuevo</span>
                                 <div class="frmSearch">
                                    <input class="form-control"  type="text" id="search-box" placeholder="Responsable" />
                                    <div id="suggesstion-box" class="suggesstion-box" ></div>
                                 </div><br>
                                 <input type="hidden" name="paData[CDNIRES]" id="cnrodni" value="{{ cnrodni }}" >
                              </div><br>
                              <div class="row col-xs-12">  
                                 <span class="input-group-text text-left alert-info">Estado</span>
                                 <select class="custom-select custom-select-sm col-4" name="paData[CESTADO]" id="paData[CESTADO]">
                                    {% set states = {'ACTIVO': 'A', 'FINALIZADO': 'F', 'ANULADO': 'X'} %}
                                    {% for data in paDatos %}
                                    {{ estado }}
                                    {% if data[0] == estado %}
                                       <option selected="selected" value="{{ states[data[0]] }}">{{ data[0] }}</option>
                                    {% else %}
                                       <option value="{{ states[data[0]] }}">{{ data[0] }}</option>
                                    {% endif %}
                                    
                                    {% endfor %}
                                 </select>
                                    <!--<input name="remitosucursal" id="remitosucursal" type="text" required  placeholder="Sucursal" class="col-xs-6">
                                    <input name="remitonumero" id="remitonumero" type="text" required placeholder="Numero"  class="col-xs-6">-->
                              </div><br>
                              <div class="row col-xs-12">
                                 <span class="input-group-text input-group-addon text-left alert-info">Auditor Actual</span>
                                 <input class=" form-control"   type="hidden"  value="{{ dniaud }}" placeholder="Auditor" name="paData[CNRODNIAUD]">
                                 <input class="form-control" value="{{ auditor }}" readonly type="text" placeholder="Auditor" name="paData[CAUDITOR]" aria-describedby="basic-addon1" style="width: 44%;">
                                 <span class="input-group-text input-group-addon text-left alert-info">Auditor Nuevo</span>
                                 <div class="frmSearch">
                                    <input class="form-control"  type="text" id="search-box1" placeholder="Auditor" />
                                    <div id="suggesstion-box1" class="suggesstion-box" ></div>
                                 </div><br>
                                 <input type="hidden" name="paData[CNRODNIAUD]" id="cnrodniaud" value="{{ dniaud }}" >
                              </div><br>
                           </div>
                           <br>
                        </div>
                     </div>
                  </div>
                  <div class="card-footer text-muted text-center" style="margin-left: 30%;">
                     <input type="submit" name="button1" value="Grabar" class="btn btn-info btn-pp col-sm-14" style="color: #fff;">
                     <input name="button1" value="Cancelar" type="submit" class="btn btn-danger btn-pp col-sm-14 formnovaidate" style="color: #fff;">
                  </div>
               </div>
               {% if pcError %}
               <div class="m-auto w-50 alert alert-danger" role="alert">{{ pcError }}</div>
               {% endif %}<br>
               {% if success %}
               <!--div class="m-auto w-50 alert alert-success" role="alert">Se registro con éxito</div>-->
               <script language="JavaScript" type="text/javascript">
                  alert("EL PROYECTO FUE CREADO CORRECTAMENTE");
               </script>
               {% endif %}

               {% if paDatos %}
               <!--div class="m-auto w-50 alert alert-success" role="alert">{{ paDatos }}</div>-->
               {% endif %}<br>
         </div>
         </form>
      </div>
   </div>
</body>
{% endblock %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-autocomplete/1.0.7/jquery.auto-complete.min.js"></script>
<script>
   $(document).ready(() => {
         $('.suggesstion-box1').on('click', '#liAuditor', e => {
            let actual = e.target.dataset.text;
            $('#search-box1').val(actual)
            console.log('loppp')
            console.log(actual)
            $('#cnrodniaud').val(actual.substr(0,8))
            $('#suggesstion-box1').css('display','none')
         })
       
         $("#search-box1").keyup(function(){
            
            $.ajax({
            type: "GET",
            url: "http://127.0.0.1:5000/proyecto",
            data:{
               'auditor': $(this).val(),
               'autocomplete': 'Auditor'
            },
            beforeSend: function(){
               $("#search-box1").css("background","#FFF url(LoaderIcon.gif) no-repeat 165px");
            },

            success: function(res){
               let box = $("#suggesstion-box1");
               box.css('display','block')
               box.html('');
               let suggestions = res.data;
               let list = $('<ul id="auto"></ul>');
               suggestions.map(sug => {
                  let sugTemp = $('<li id="auto"></li>').append($('<a id="liAuditor" data-text="'+sug+'" href="javascript:void(0);"></a>').text(sug));
                  list.append(sugTemp)
               })
               box.append(list);
               
            }
            });
         });
         function selectPersona(val) {
            $("#search-box1").val(val);
            $("#suggesstion-box1").hide();
         }
   })
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-autocomplete/1.0.7/jquery.auto-complete.min.js"></script>
<script>
   $(document).ready(() => {
         $('.suggesstion-box').on('click', '#liRespon', e => {
            let actual = e.target.dataset.text;
            $('#search-box').val(actual)
            console.log('loppp')
            console.log(actual)
            $('#cnrodni').val(actual.substr(0,8))
            $('#suggesstion-box').css('display','none')
         })
       
         $("#search-box").keyup(function(){
            
            $.ajax({
            type: "GET",
            url: "http://127.0.0.1:5000/proyecto",
            data:{
               'respon': $(this).val(),
               'autocomplete': 'Responsable'
            },
            beforeSend: function(){
               $("#search-box").css("background","#FFF url(LoaderIcon.gif) no-repeat 165px");
            },

            success: function(res){
               let box = $("#suggesstion-box");
               box.css('display','block')
               box.html('');
               let suggestions = res.data;
               let list = $('<ul id="auto"></ul>');
               suggestions.map(sug => {
                  let sugTemp = $('<li id="auto"></li>').append($('<a id="liRespon" data-text="'+sug+'" href="javascript:void(0);"></a>').text(sug));
                  list.append(sugTemp)
               })
               box.append(list);
               
            }
            });
         });
         function selectPersona(val) {
            $("#search-box").val(val);
            $("#suggesstion-box").hide();
         }
   })
</script>
</html>